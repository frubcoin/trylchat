/* ═══════════════════════════════════
   tryl.chat — Minimal Stylesheet
   ═══════════════════════════════════ */

@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Jersey+10&display=swap');

/* Geist Pixel from Vercel */
@font-face {
  font-family: 'Geist Pixel';
  src: url('./fonts/GeistPixel.woff2') format('woff2');
  font-weight: 400;
  font-style: normal;
}

/* ═══ TOKENS ═══ */
:root {
  --bg: #111111;
  --bg-elevated: #161616;
  --bg-surface: #1c1c1c;
  --bg-hover: #242424;
  --border: #2a2a2a;
  --border-light: #333;
  --text: #e8e8e8;
  --text-secondary: #888;
  --text-muted: #555;
  --accent: #F9FAFB;
  --accent-rgb: 255, 255, 255;
  --font-body: 'Geist Pixel', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
  --font-wordmark: 'Jersey 10', cursive;
  --radius: 10px;
  --radius-sm: 6px;
}

/* ═══ RESET ═══ */
*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html,
body {
  height: 100%;
  height: 100dvh;
  /* dynamic internet viewport height */
  margin: 0;
  padding: 0;
  overflow: hidden;
  /* Prevent body scroll */
}

body {
  font-family: var(--font-body);
  font-size: 15px;
  color: var(--text);
  background-color: #111111;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  overflow-x: hidden;
  max-width: 100vw;
}

.hidden {
  display: none !important;
}

/* ═══ LOGIN ═══ */
#login-overlay {
  position: fixed;
  inset: 0;
  z-index: 1000;
  display: flex;
  align-items: center;
  justify-content: center;
  background: radial-gradient(circle, transparent 20%, rgba(0, 0, 0, 0.4) 100%);
  overflow: hidden;
  /* Ensure noise doesn't scroll */
  pointer-events: auto;
}

.bg {
  position: fixed;
  top: -50%;
  left: -50%;
  right: -50%;
  bottom: -50%;
  width: 200%;
  height: 200vh;
  background: transparent url('noise-transparent.png') repeat 0 0;
  background-repeat: repeat;
  background-size: 200px 200px;
  animation: bg-animation .2s infinite;
  opacity: .9;
  visibility: visible;
  pointer-events: none;
  z-index: 0;
}

@keyframes bg-animation {
  0% {
    transform: translate(0, 0)
  }

  10% {
    transform: translate(-5%, -5%)
  }

  20% {
    transform: translate(-10%, 5%)
  }

  30% {
    transform: translate(5%, -10%)
  }

  40% {
    transform: translate(-5%, 15%)
  }

  50% {
    transform: translate(-10%, 5%)
  }

  60% {
    transform: translate(15%, 0)
  }

  70% {
    transform: translate(0, 10%)
  }

  80% {
    transform: translate(-15%, 0)
  }

  90% {
    transform: translate(10%, 5%)
  }

  100% {
    transform: translate(5%, 0)
  }
}

#chat-page {
  display: flex;
  flex-direction: column;
  height: 100dvh;
  width: 100%;
  overflow: hidden;
  position: fixed;
  /* prevent rubber banding */
  inset: 0;
}

#main-layout {
  display: flex;
  flex: 1;
  /* Replace fixed height with flex-grow */
  min-height: 0;
  /* Important for nested scroll */
  width: 100%;
  position: relative;
}

#login-box {
  text-align: center;
  max-width: 360px;
  width: 90%;
  padding: 40px 20px;
}

.login-wordmark {
  font-family: var(--font-wordmark);
  font-size: 80px;
  color: var(--accent);
  line-height: 1;
  margin-bottom: 8px;
  letter-spacing: 1px;
}

.login-subtitle {
  color: var(--text-secondary);
  font-size: 15px;
  font-weight: 300;
  margin-bottom: 32px;
}

#login-form {
  display: flex;
  flex-direction: column;
  gap: 12px;
  align-items: center;
}

#username-input {
  font-family: var(--font-body);
  font-size: 16px;
  font-weight: 400;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 14px 20px;
  width: 100%;
  border-radius: var(--radius);
  outline: none;
  transition: border-color 0.2s;
  text-align: center;
  touch-action: manipulation;
}

#username-input:focus {
  border-color: var(--text-secondary);
}

#username-input::placeholder {
  color: var(--text-muted);
}

.btn-primary {
  font-family: var(--font-body);
  font-size: 15px;
  font-weight: 500;
  background: var(--accent);
  color: #000;
  border: none;
  padding: 14px 32px;
  border-radius: var(--radius);
  cursor: pointer;
  width: 100%;
  transition: opacity 0.2s;
  touch-action: manipulation;
}

@media (hover: hover) {
  .btn-primary:hover {
    opacity: 0.85;
  }
}

.btn-primary:active {
  opacity: 0.6;
}

.btn-text {
  background: none;
  border: none;
  font-family: var(--font-body);
  font-size: 13px;
  color: var(--text-muted);
  cursor: pointer;
  text-decoration: underline;
  margin-top: 8px;
}

.btn-text:hover {
  color: var(--text);
}

.login-actions {
  display: flex;
  flex-direction: column;
  gap: 12px;
  width: 100%;
}

.input-minimal {
  font-family: var(--font-body);
  font-size: 14px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 12px 16px;
  border-radius: var(--radius);
  outline: none;
  transition: border-color 0.2s;
  text-align: center;
  width: 100%;
}

.input-minimal:focus {
  border-color: var(--text-secondary);
}

.divider {
  font-size: 12px;
  color: var(--text-muted);
  margin: 4px 0;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.divider::before,
.divider::after {
  content: '';
  height: 1px;
  background: var(--border);
  flex: 1;
}

.input-group {
  display: flex;
  gap: 8px;
  width: 100%;
}

/* Flush variant: no gap, shared border */
.input-group--flush {
  gap: 0;
}

.input-group--flush .input-minimal--left {
  border-right: none;
  border-top-right-radius: 0;
  border-bottom-right-radius: 0;
}

.input-group--flush .btn-icon--right {
  border-top-left-radius: 0;
  border-bottom-left-radius: 0;
}

.input-group--flush:focus-within .input-minimal--left,
.input-group--flush:focus-within .btn-icon--right {
  border-color: var(--text-secondary);
}

.btn-icon {
  width: 42px;
  flex-shrink: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
  font-size: 18px;
}

.btn-icon:hover {
  border-color: var(--text-secondary);
  background: var(--bg-hover);
}


.login-hint {
  margin-top: 24px;
  color: var(--text-muted);
  font-size: 13px;
  font-weight: 300;
}

/* ═══ ADMIN BADGE ═══ */
.admin-badge {
  display: inline-block;
  background: var(--accent);
  color: #000;
  font-size: 9px;
  font-weight: 800;
  padding: 1px 4px;
  border-radius: 2px;
  margin-left: 6px;
  vertical-align: middle;
  letter-spacing: 0.5px;
  line-height: 1;
  font-family: var(--font-body);
}

.admin-badge.mini {
  font-size: 8px;
  padding: 1px 5px;
  margin-left: 4px;
}

#pinned-banner {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 10px 16px;
  background: rgba(var(--accent-rgb), 0.05);
  border-bottom: 1px solid var(--border);
  font-size: 13px;
  color: var(--text);
  margin-bottom: 4px;
}

#pinned-banner.hidden {
  display: none;
}

.pin-label {
  background: var(--accent);
  color: #000;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 2px;
  letter-spacing: 0.5px;
}

#pin-text {
  font-family: var(--font-pixel);
  flex: 1;
}

/* ═══ HEADER ═══ */
#site-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 16px 24px;
  border-bottom: 1px solid var(--border);
  background: var(--bg);
  position: sticky;
  top: 0;
  z-index: 100;
}

.header-left {
  display: flex;
  align-items: center;
}

.login-wordmark {
  font-family: var(--font-wordmark);
  font-size: 80px;
  color: var(--accent);
  line-height: 1;
  margin-bottom: 8px;
  letter-spacing: 1px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 16px;
}

.header-wordmark {
  font-family: var(--font-wordmark);
  font-size: 32px;
  color: #F9FAFB;
  letter-spacing: 1px;
  font-weight: 400;
  line-height: 1;
  display: flex;
  align-items: center;
  gap: 8px;
}

.wordmark-icon {
  height: 0.7em;
  width: auto;
  fill: #f9fafb;
}

.header-right {
  display: flex;
  align-items: center;
}

.header-meta {
  font-size: 13px;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 6px;
}

.online-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #4ade80;
  border-radius: 50%;
  animation: dotPulse 2s ease-in-out infinite;
}

.header-separator {
  opacity: 0.5;
  margin: 0 4px;
}

@keyframes dotPulse {

  0%,
  100% {
    opacity: 1;
    transform: scale(1);
  }

  50% {
    opacity: 0.5;
    transform: scale(0.8);
  }
}

@keyframes pulse {

  0%,
  100% {
    opacity: 1;
  }

  50% {
    opacity: 0.4;
  }
}

@keyframes highlight-msg {
  0% {
    background: rgba(var(--accent-rgb), 0.3);
  }

  /* increased from 0.2 */
  100% {
    background: transparent;
  }
}

.highlight {
  animation: highlight-msg 1.5s ease-out;
  /* faster */
}

/* ═══ MAIN LAYOUT ═══ */
/* #chat-page is defined above with fixed positioning and 100dvh */

#main-layout {
  display: flex;
  flex: 1;
  min-height: 0;
  width: 100%;
  position: relative;
}

/* ═══ CHAT AREA ═══ */
#chat-area {
  position: relative;
  /* Context for absolute positioning of emoji picker */
  flex: 1;
  display: flex;
  flex-direction: column;
  min-width: 0;
}

/* current chat-messages style at 275 is flex column. We want children to be centered or the container to be centered? 
   Better to make the container full width but children constrained? 
   No, let's constrain the content wrapper if possible, or just the messages. 
   Actually, `align-items: center` in column flexbox centers the children horizontally. 
   Then children need a width. */

#chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 20px 24px;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

/* Constrain messages width */
.chat-msg,
.system-msg {
  width: 100%;
  max-width: 900px;
  margin-left: auto;
  margin-right: auto;
}

/* Messages */
.chat-msg {
  position: relative;
  padding: 4px 0;
  animation: fadeIn 0.2s ease-out;
  word-wrap: break-word;
  overflow-wrap: break-word;
  position: relative;
  /* Context for reply button */
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(4px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.chat-msg .msg-header {
  display: flex;
  align-items: baseline;
  gap: 8px;
  margin-bottom: 2px;
}

.chat-msg .msg-username {
  font-size: 13px;
  font-weight: 600;
}

.owner-badge {
  background: #FFD700;
  color: #000;
  font-size: 9px;
  padding: 0 8px;
  border-radius: 20px;
  font-weight: 700;
  vertical-align: middle;
  letter-spacing: 0.5px;
  height: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  width: auto;
}

.admin-badge {
  background: #ff3333;
  color: #f9fafb;
  font-size: 9px;
  padding: 0 8px;
  border-radius: 20px;
  font-weight: 700;
  vertical-align: middle;
  letter-spacing: 0.5px;
  height: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  width: auto;
}

.mod-badge {
  background: #00cc66;
  color: #f9fafb;
  font-size: 9px;
  padding: 0 8px;
  border-radius: 20px;
  font-weight: 700;
  vertical-align: middle;
  letter-spacing: 0.5px;
  height: 16px;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  line-height: 1;
  width: auto;
}

.chat-msg .msg-time {
  font-size: 12px;
  color: var(--text-muted);
}

.chat-msg .msg-text {
  font-size: 15px;
  line-height: 1.5;
  color: var(--text);
  word-wrap: break-word;
  white-space: pre-wrap;
}

.msg-translation {
  font-size: 12px;
  opacity: 0.7;
  font-style: italic;
  margin-top: 4px;
  color: var(--text-muted);
  border-top: 1px solid var(--bg-surface);
  padding-top: 2px;
}

/* System messages */
.system-msg {
  text-align: center;
  color: var(--text-muted);
  font-size: 13px;
  padding: 6px 0;
}

#typing-indicator {
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  margin-bottom: 6px;
  z-index: 2000;
  max-width: 90%;
  padding: 6px 16px;
  border-radius: 20px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  color: var(--text-muted);
  font-size: 12px;
  font-weight: 500;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  pointer-events: none;
  transition: opacity 0.2s;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
  display: block;
  /* Ensure visibility when not hidden */
}

#typing-indicator.hidden {
  display: none !important;
}

.msg-text a {
  color: #7bbdff;
  text-decoration: underline;
}

.msg-embed {
  margin-top: 8px;
  border: 1px solid var(--border);
  border-radius: 8px;
  overflow: hidden;
  background: #0f0f0f;
  max-width: min(100%, 520px);
}

.msg-embed iframe,
.msg-embed video,
.msg-embed img {
  display: block;
  width: 100%;
  max-width: 100%;
  border: 0;
}

.msg-embed iframe {
  aspect-ratio: 16 / 9;
}

.msg-embed img {
  height: auto;
}

.quick-emoji-picker {
  display: grid;
  grid-template-columns: repeat(6, minmax(0, 1fr));
  gap: 6px;
  padding: 10px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: 10px;
}

.quick-emoji-picker button {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
  border-radius: 8px;
  padding: 6px;
  font-size: 18px;
  cursor: pointer;
}

.quick-emoji-picker button:hover {
  border-color: var(--text-secondary);
}

/* Chat input */
#chat-form {
  border-top: 1px solid var(--border);
  background: var(--bg);
  padding: 16px 24px;
  display: flex;
  justify-content: center;
  position: relative;
  /* Context for typing indicator */
  /* Center the input container */
}

#chat-input-area {
  display: flex;
  gap: 12px;
  align-items: center;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: 28px;
  padding: 4px;
  box-shadow: var(--shadow);
  /* Removed width: 100%/max-width: 100% to prevent sidebar squash. 
     The parent #chat-form needs to handle the width or we use flex. */
  flex: 1;
  min-width: 0;
  /* Allow shrinking */
  margin: 0 auto;
}

#color-picker {
  -webkit-appearance: none;
  -moz-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  background-color: transparent;
  border: none;
  cursor: pointer;
  padding: 0;
  flex-shrink: 0;
}

#color-picker::-webkit-color-swatch {
  border-radius: 50%;
  border: 1px solid var(--border);
}

#color-picker::-webkit-color-swatch-wrapper {
  padding: 0;
}

#chat-input {
  flex: 1;
  background: transparent;
  border: none;
  font-family: 'Inter', sans-serif;
  font-size: 15px;
  color: var(--text);
  outline: none;
}

#chat-input:focus {
  border-color: var(--text-muted);
}

#chat-input::placeholder {
  color: var(--text-muted);
}

.btn-send {
  display: flex;
  align-items: center;
  justify-content: center;
  border: none;
  border-radius: 50%;
  cursor: pointer;
  width: 38px;
  height: 38px;
  padding: 0;
  flex-shrink: 0;
  background: transparent;
}


/* ═══ EMOJI PICKER & COLOR PICKER ═══ */
#emoji-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
  position: relative;
  /* Context for pickers */
}

.color-btn {
  opacity: 0.7;
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid rgba(255, 255, 255, 0.2);
  cursor: pointer;
  padding: 0;
  transition: transform 0.2s, border-color 0.2s;
  background-color: var(--text-main);
  /* Default, updated by JS */
  pointer-events: auto !important;
  position: relative;
  z-index: 10;
  user-select: none;
}

.color-btn:hover {
  opacity: 1;
  border-color: rgba(255, 255, 255, 0.6);
}

#color-picker-popover {
  position: absolute;
  bottom: 100%;
  left: 0;
  margin-bottom: 12px;
  z-index: 101;
  /* Above emoji picker if needed */
  background: var(--bg-surface);
  padding: 12px;
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  border: 1px solid var(--border);
  animation: slideUp 0.15s ease-out;
}

#color-picker-popover input[type="color"] {
  display: block;
}

#btn-emoji {
  width: 36px;
  height: 36px;
  background: transparent;
  border: none;
  font-size: 37px;
  cursor: pointer;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.1s, opacity 0.2s;
  opacity: 0.7;
  line-height: 1;
}

#btn-emoji:hover {
  opacity: 1;
  background: rgba(255, 255, 255, 0.05);
}

#emoji-picker-container {
  position: absolute;
  bottom: 100%;
  /* Position above the wrapper */
  left: 0;
  /* Offset to not overlap color picker if both open (unlikely) */
  margin-bottom: 12px;
  z-index: 100;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
  border-radius: 12px;
  overflow: hidden;
  animation: slideUp 0.15s ease-out;
}

@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* ═══ MOBILE RESPONSIVENESS ═══ */
.mobile-only {
  display: none !important;
}

@media (max-width: 768px) {
  .mobile-only {
    display: flex !important;
  }

  #rooms-sidebar,
  #sidebar {
    position: fixed;
    top: 60px;
    /* Below header */
    bottom: 0;
    width: 200px;
    background: var(--bg);
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 10px 0 30px rgba(0, 0, 0, 0.5);
    z-index: 1000;
  }

  #sidebar {
    left: auto;
    right: 0;
    transform: translateX(100%);
    box-shadow: -10px 0 30px rgba(0, 0, 0, 0.5);
  }

  /* When menu is active, reveal sidebars */
  body.mobile-menu-active #rooms-sidebar {
    transform: translateX(0);
  }

  body.mobile-users-active #sidebar {
    transform: translateX(0);
  }

  #main-layout {
    flex-direction: column;
  }

  #site-header {
    padding: 12px 16px;
    height: 60px;
  }

  .header-wordmark {
    font-size: 24px;
  }

  /* Hide meta info on small screens if too cramped */
  .header-meta {
    font-size: 11px;
  }

  #chat-messages {
    padding: 12px 16px;
  }

  #chat-input-area {
    padding: 4px 4px 4px 12px;
  }

  .chat-msg .msg-text {
    font-size: 14px;
  }

  /* Login scale */
  #login-box {
    padding: 24px 16px;
  }

  .login-wordmark {
    font-size: 60px;
  }
}


/* ═══ ROOMS SIDEBAR (LEFT) ═══ */
#rooms-sidebar {
  width: 160px;
  flex-shrink: 0;
  border-right: 1px solid var(--border);
  padding: 20px 12px;
  display: flex;
  flex-direction: column;
  gap: 24px;
  overflow-y: auto;
  background: var(--bg);
  position: relative;
  z-index: 1;
}

#room-list {
  list-style: none;
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.room-item {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 12px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: all 0.15s ease;
  font-size: 14px;
  color: var(--text-secondary);
  user-select: none;
  border: 1px solid transparent;
  touch-action: manipulation;
}

.room-item:hover {
  background: var(--bg-hover);
  color: var(--text);
}

.room-item.active {
  background: var(--bg-surface);
  color: var(--text);
  border-color: var(--border);
}

.room-item.locked {
  opacity: 0.45;
  cursor: not-allowed;
}

.room-item.locked:hover {
  background: transparent;
  color: var(--text-secondary);
}

.room-icon {
  font-size: 16px;
  width: 20px;
  text-align: center;
  flex-shrink: 0;
}

.room-name {
  font-size: 13px;
  font-weight: 500;
  letter-spacing: 0.3px;
}

/* ═══ SIDEBAR (RIGHT) ═══ */
#sidebar {
  width: 220px;
  flex-shrink: 0;
  border-left: 1px solid var(--border);
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 24px;
  overflow-y: auto;
}

.sidebar-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--text-muted);
  margin-bottom: 12px;
}

#user-list {
  list-style: none;
}

#user-list li {
  padding: 6px 0;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

#user-list li::before {
  content: '';
  display: inline-block;
  width: 6px;
  height: 6px;
  background: currentColor;
  border-radius: 50%;
  opacity: 0.6;
}

.no-users {
  color: var(--text-muted);
  font-style: italic;
  font-size: 13px !important;
}

.no-users::before {
  display: none !important;
}

#hit-counter {
  font-size: 28px;
  font-weight: 300;
  color: var(--text-secondary);
  font-variant-numeric: tabular-nums;
}

/* ═══ SCROLLBAR ═══ */
#chat-messages::-webkit-scrollbar {
  width: 6px;
}

#chat-messages::-webkit-scrollbar-track {
  background: transparent;
}

#chat-messages::-webkit-scrollbar-thumb {
  background: var(--border);
  border-radius: 3px;
}

#chat-messages::-webkit-scrollbar-thumb:hover {
  background: var(--text-muted);
}

/* ═══ REMOTE CURSORS ═══ */
.remote-cursor {
  position: fixed;
  pointer-events: none;
  z-index: 9998;
  transition: left 0.08s linear, top 0.08s linear;
  display: flex;
  align-items: center;
  gap: 6px;
}

.remote-cursor-dot {
  display: block;
  width: 10px;
  height: 10px;
  border-radius: 50%;
  border: 1.5px solid rgba(255, 255, 255, 0.5);
}

.remote-cursor-label {
  font-family: var(--font-body);
  font-size: 11px;
  font-weight: 500;
  white-space: nowrap;
  background: rgba(14, 14, 14, 0.9);
  padding: 2px 8px;
  border-radius: 4px;
  border: 1px solid var(--border);
}

/* ═══ CURSOR TRAIL ═══ */
.trail-star {
  position: fixed;
  pointer-events: none;
  z-index: 9999;
  font-size: 12px;
  opacity: 0.3;
  animation: trailFade 0.6s ease-out forwards;
}

@keyframes pulse {
  0% {
    transform: scale(1);
    opacity: 1;
  }

  50% {
    transform: scale(1.2);
    opacity: 0.8;
  }

  100% {
    transform: scale(1);
    opacity: 1;
  }
}

@keyframes glow {
  0% {
    background: rgba(var(--accent-rgb), 0.3);
    border-color: var(--accent);
  }

  100% {
    background: rgba(var(--accent-rgb), 0.05);
    border-color: var(--border);
  }
}

@keyframes trailFade {
  0% {
    opacity: 0.3;
    transform: scale(1);
  }

  100% {
    opacity: 0;
    transform: scale(0.3) translateY(-10px);
  }
}

/* ═══ SELECTION ═══ */
::selection {
  background: var(--accent);
  color: var(--bg);
}

/* ═══ RESPONSIVE ═══ */
@media (max-width: 768px) {
  #sidebar-backdrop {
    display: none;
    position: fixed;
    top: 60px;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(2px);
    z-index: 950;
    cursor: pointer;
  }

  body.mobile-menu-active #sidebar-backdrop,
  body.mobile-users-active #sidebar-backdrop {
    display: block !important;
  }

  #sidebar,
  #rooms-sidebar {
    display: none;
    position: fixed;
    top: 60px;
    /* Below header */
    bottom: 0;
    background: var(--bg-elevated);
    z-index: 1000;
    width: 280px;
    border: none;
  }

  body.mobile-menu-active #rooms-sidebar {
    display: flex !important;
    left: 0;
    border-right: 1px solid var(--border);
  }

  body.mobile-users-active #sidebar {
    display: flex !important;
    right: 0;
    border-left: 1px solid var(--border);
  }

  #site-header {
    padding: 12px 16px;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 60px;
    z-index: 1100;
    background: var(--bg);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
  }

  #main-layout {
    padding-top: 60px;
  }

  #chat-messages {
    padding: 16px;
  }

  #chat-form {
    padding: 12px 16px;
  }

  /* Make onboarding buttons easier to press */
  .btn-primary {
    padding: 16px 32px;
    font-size: 16px;
  }

  .input-minimal {
    padding: 14px 18px;
    font-size: 16px;
  }
}

/* ═══ ADMIN ═══ */
#admin-panel {
  margin-top: auto;
  display: flex;
  gap: 8px;
  width: 100%;
}

#round-select {
  flex: 1;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  color: var(--text);
  padding: 8px;
  border-radius: var(--radius-sm);
  font-family: var(--font-body);
  font-size: 13px;
  outline: none;
  cursor: pointer;
}

#round-select:hover {
  border-color: var(--text-secondary);
}

#btn-admin-game {
  background: var(--bg-surface);
  color: var(--text-muted);
  border: 1px solid var(--border);
  padding: 10px 16px;
  border-radius: var(--radius);
  cursor: pointer;
  font-family: var(--font-body);
  font-size: 12px;
  transition: all 0.2s;
  flex-shrink: 0;
  white-space: nowrap;
  touch-action: manipulation;
}

#btn-admin-game:hover {
  border-color: #ff3333;
  color: #ff3333;
}


/* ═══ GAME OVERLAY ═══ */
#game-overlay {
  position: fixed;
  inset: 0;
  z-index: 10000;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: var(--font-wordmark);
  font-size: 120px;
  color: #f9fafb;
  cursor: pointer;
  user-select: none;
  text-align: center;
  line-height: 1;
}

/* STATE: READY (RED) */
#game-overlay.state-ready {
  background: #ff3333;
}

/* STATE: GO (GREEN) */
#game-overlay.state-go {
  background: #33ff33;
  color: #000;
}

/* STATE: DQ (GRAY/RED) */
#game-overlay.state-dq {
  background: #333;
  color: #ff3333;
  font-size: 80px;
}

/* ═══ AI STATUS ═══ */
#ai-status {
  font-size: 11px;
  color: var(--text-muted);
  margin-left: 8px;
  display: flex;
  align-items: center;
  gap: 4px;
  cursor: default;
  position: relative;
  white-space: nowrap;
}

#ai-status.status-downloading {
  color: #7bbdff;
}

#ai-status.status-ready {
  color: #4ade80;
}

#ai-status.status-unavailable {
  color: #ff3333;
  cursor: help;
  text-decoration-line: underline;
  text-decoration-style: dotted;
}

/* ═══ TYPING INDICATOR ═══ */
/* ═══ TYPING INDICATOR ═══ */
#typing-indicator {
  font-size: 11px;
  color: var(--text);
  background: var(--bg-hover);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 4px 12px;

  /* Positioning: Floating Bubble */
  position: absolute;
  bottom: 100%;
  /* Above the input */
  left: 16px;
  margin-bottom: 8px;

  display: flex;
  align-items: center;
  gap: 6px;

  opacity: 1;
  transform: translateY(0);
  transition: opacity 0.2s, transform 0.2s;
  z-index: 10;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

/* Pseudo-element for the "tail" of the bubble */
#typing-indicator::after {
  content: '';
  position: absolute;
  bottom: -4px;
  left: 12px;
  width: 8px;
  height: 8px;
  background: var(--bg-hover);
  border-bottom: 1px solid var(--border);
  border-right: 1px solid var(--border);
  transform: rotate(45deg);
}

#typing-indicator.hidden {
  display: flex !important;
  /* Keep display flex for transition */
  opacity: 0;
  transform: translateY(10px);
  pointer-events: none;
}

@keyframes typing-pulse {
  0% {
    transform: scale(1);
    opacity: 0.8;
  }

  50% {
    transform: scale(1.05);
    opacity: 1;
  }

  100% {
    transform: scale(1);
    opacity: 0.8;
  }
}

#typing-indicator:not(.hidden) {
  animation: typing-pulse 2s infinite ease-in-out;
}


/* Tooltip */
#ai-status .ai-tooltip {
  visibility: hidden;
  background-color: #111;
  color: #eee;
  text-align: center;
  border-radius: 6px;
  padding: 8px 12px;
  position: absolute;
  z-index: 10;
  bottom: 125%;
  left: 50%;
  transform: translateX(-50%);
  opacity: 0;
  transition: opacity 0.2s;
  width: 220px;
  font-size: 11px;
  border: 1px solid var(--border);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  pointer-events: none;
  white-space: normal;
  line-height: 1.4;
}

#ai-status .ai-tooltip::after {
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  margin-left: -5px;
  border-width: 5px;
  border-style: solid;
  border-color: var(--border) transparent transparent transparent;
}

#ai-status:hover .ai-tooltip {
  visibility: visible;
  opacity: 1;
}


/* ═══ REPLY BAR ═══ */
/* ═══ TYPING INDICATOR ═══ */
#typing-indicator {
  font-size: 12px;
  color: var(--text-muted);
  font-style: italic;
  margin-bottom: 4px;
  min-height: 18px;
  display: flex;
  align-items: center;
  padding-left: 8px;
}

#typing-indicator.hidden {
  display: none !important;
}

/* ═══ REPLY BAR ═══ */
#chat-input-area {
  position: relative;
  display: flex;
  align-items: center;
  gap: 16px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: 50px;
  padding: 10px 12px;
  transition: all 0.2s;
  z-index: 20;
}

#emoji-wrapper {
  display: flex;
  align-items: center;
  gap: 8px;
}

.btn-send {
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  color: var(--accent);
  transition: transform 0.2s;
  flex-shrink: 0;
  width: 40px;
  height: 40px;
}


#reply-bar {
  position: absolute;
  bottom: 100%;
  /* Sits directly on top of input */
  left: 0;
  right: 0;
  background: var(--bg-surface);
  padding: 8px 16px;
  border-radius: 24px 24px 0 0;
  border: 1px solid var(--border);
  border-bottom: none;
  /* Merge */
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 13px;
  color: var(--text-muted);
  z-index: 10;
  margin-bottom: -1px;
  /* Overlap border */
}

#reply-bar.hidden {
  display: none;
}

/* When reply is visible, flatten top input corners */
#chat-input-area:has(#reply-bar:not(.hidden)) {
  border-top-left-radius: 0;
  border-top-right-radius: 0;
  border-top-color: transparent;
  /* Seamless merge */
}

/* Re-adding Reply Content Styles */
.reply-content {
  display: flex;
  flex-direction: column;
  gap: 2px;
  overflow: hidden;
}

.reply-to {
  font-size: 11px;
  color: var(--text-muted);
}

.reply-to b {
  color: var(--text-main);
}

#reply-text-preview {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  color: var(--text);
  max-width: 300px;
}

#btn-cancel-reply {
  background: none;
  border: none;
  color: var(--text-muted);
  cursor: pointer;
  font-size: 16px;
  padding: 4px;
  line-height: 1;
}

#btn-cancel-reply:hover {
  color: var(--accent);
}


/* ═══ COMPACT MESSAGES ═══ */
.chat-msg.compact {
  margin-top: 0px;
  padding-top: 2px;
  padding-bottom: 2px;
}

.chat-msg.compact .msg-header {
  display: none;
}

/* ═══ REPLY IN CHAT ═══ */
.msg-reply-context {
  display: block;
  font-size: 11px;
  color: var(--text);
  margin-bottom: 6px;
  padding: 4px 8px;
  background: rgba(255, 255, 255, 0.05);
  border-left: 2px solid var(--accent);
  border-radius: 4px;
  opacity: 0.9;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  cursor: pointer;
  max-width: 100%;
}

.msg-reply-context .reply-to-user {
  font-weight: 700;
  color: var(--accent);
  margin-right: 4px;
}

.msg-reply-context:hover {
  opacity: 1;
  text-decoration: underline;
}

/* AI Status */
#ai-status {

  font-size: 11px;
  font-weight: 500;
  margin-top: auto;
  padding: 8px 12px;
  border-top: 1px solid var(--border);
  display: flex;
  justify-content: center;
  align-items: center;
  width: 100%;
  text-align: center;
}

.ai-status-downloading {
  color: #FFA500;
  background: rgba(255, 165, 0, 0.1);
  animation: pulse 1.5s infinite;
}

.ai-status-ready {
  color: #4ade80;
  background: rgba(74, 222, 128, 0.1);
}

/* ═══ SCROLL BUTTONS (SIDEBAR) ═══ */
/* Ensure sidebar has flex column and relative positioning */
#rooms-sidebar {
  display: flex;
  flex-direction: column;
  position: relative;
}

/* SIDEBAR FOOTER */
#sidebar,
#rooms-sidebar {
  width: 280px;
  /* Increased from 250px */
  background: var(--bg-elevated);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  flex-shrink: 0;
  z-index: 100;
  position: relative;
  /* For handle positioning */
  transition: width 0.0s;
  /* Disable transition during drag */
  overflow-x: hidden;
  /* Prevent scrollbars from handles */
}

.resize-handle {
  position: absolute;
  top: 0;
  bottom: 0;
  width: 6px;
  cursor: col-resize;
  z-index: 101;
  transition: background 0.2s;
}

#resizer-left {
  right: -3px;
  /* Center on border */
}

#resizer-right {
  left: -3px;
  /* Center on border */
}

.resize-handle:hover,
body.resizing .resize-handle {
  background: rgba(var(--accent-rgb), 0.5);
}

.sidebar-footer {
  padding: 12px;
  border-top: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.zoom-controls {
  display: flex;
  align-items: center;
  gap: 8px;
  width: 100%;
}

.scroll-controls {
  display: flex;
  justify-content: center;
  gap: 8px;
}

#btn-zoom-reset {
  background: var(--bg-hover);
  border: 1px solid var(--border-light);
  color: var(--text);
  padding: 4px 8px;
  border-radius: 4px;
  cursor: pointer;
  font-size: 12px;
  font-weight: 600;
}

#scale-slider {
  flex: 1;
  width: 0;
  /* Force flex item to shrink below content size if needed */
  accent-color: var(--text);
  cursor: pointer;
  height: 4px;
}

.scroll-btn {
  width: 40px;
  height: 40px;
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text-muted);
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.2s;
}

.scroll-btn:hover {
  background: var(--bg-surface);
  color: var(--text);
  border-color: var(--text-secondary);
}

.scroll-btn svg {
  width: 20px;
  height: 20px;
  display: block;
  /* Fix separate line height */
}

/* Fix SVG alignment */
/* ═══ MESSAGE ACTIONS (Hover Buttons) ═══ */
.msg-actions {
  float: right;
  display: flex;
  gap: 2px;
  margin-left: 8px;
  margin-right: 0;
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
  /* Disable when hidden */
}

.chat-msg:hover .msg-actions {
  opacity: 1;
  pointer-events: auto;
}

.msg-action-btn {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 3px;
  color: var(--text-muted);
  transition: all 0.2s;
  width: 22px;
  height: 22px;
}

.msg-action-btn:hover {
  background: var(--bg-hover);
  color: var(--text);
}

.msg-action-btn img,
.msg-action-btn svg {
  width: 16px;
  height: 16px;
  opacity: 0.7;
  display: block;
  transition: opacity 0.2s;
}

.msg-action-btn:hover img,
.msg-action-btn:hover svg {
  opacity: 1;
}




/* ═══ REACTIONS ═══ */
.msg-reactions {
  display: flex;
  flex-wrap: wrap;
  gap: 4px;
  margin-top: 4px;
}

.msg-reactions:empty {
  display: none;
}


.reaction-pill {
  background: var(--bg-surface);
  border: 1px solid var(--border-color);
  border-radius: 8px;
  padding: 2px 6px;
  font-size: 11px;
  color: var(--text);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 4px;
  transition: all 0.2s;
}

.reaction-pill:hover {
  background: var(--bg-hover);
  border-color: var(--text-muted);
}

.reaction-pill.active {
  background: rgba(var(--accent-rgb), 0.1);
  border-color: var(--accent);
  color: var(--text);
  box-shadow: 0 0 5px rgba(0, 255, 255, 0.2);
}


.reaction-emoji {
  font-size: 13px;
  line-height: 1;
}

.reaction-count {
  font-weight: 600;
}


.reaction-picker-popover {

  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
  border-radius: 12px;
  overflow: hidden;
  border: 1px solid var(--border);
  animation: popIn 0.2s ease-out;
}

@keyframes popIn {
  from {
    opacity: 0;
    transform: scale(0.95) translateY(-10px);
  }

  to {
    opacity: 1;
    transform: scale(1) translateY(0);
  }
}

/* ═══ COMMAND POPOVER ═══ */
#command-popover {
  position: absolute;
  /* Default, overridden by JS */
  bottom: 0;
  right: 0;
  width: 250px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  z-index: 99999;
  /* Max Z-index */
  overflow: visible;
  /* Ensure content shows */
  font-family: var(--font-body);
  display: flex;
  flex-direction: column;
}

.command-header {
  padding: 8px 12px;
  background: var(--bg-hover);
  border-bottom: 1px solid var(--border);
  font-weight: 600;
  font-size: 13px;
  color: var(--text-secondary);
  display: flex;
  justify-content: space-between;
  align-items: center;
}

.command-list {
  padding: 8px;
  max-height: 300px;
  overflow-y: auto;
}

.command-item {
  display: flex;
  flex-direction: column;
  padding: 6px 8px;
  border-radius: var(--radius-sm);
  cursor: pointer;
  transition: background 0.2s;
}

.command-item:hover {
  background: var(--bg-hover);
}

.cmd-code {
  font-family: monospace;
  color: #a3e635;
  /* lime-400 */
  font-size: 13px;
  margin-bottom: 2px;
}

.cmd-desc {
  font-size: 11px;
  color: var(--text-muted);
}

/* ═══ APPEARANCE POPOVER ═══ */
#appearance-popover {
  position: absolute;
  bottom: 50px;
  right: 40px;
  /* Offset from command popover */
  width: 220px;
  background: var(--bg-surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5);
  z-index: 2000;
  padding: 12px;
  display: flex;
  flex-direction: column;
  gap: 10px;
}

.appearance-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}

.appearance-label {
  font-size: 13px;
  font-weight: 500;
  color: var(--text-secondary);
}

#emoji-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  gap: 6px;
  padding-right: 8px;
  border-right: 1px solid var(--border);
  z-index: 100;
  /* Ensure clicks work (high priority) */
}

/* Ensure SVG doesn't steal clicks */
.icon-btn svg {
  pointer-events: none;
}

.icon-btn {
  background: transparent;
  border: none;
  cursor: pointer;
  padding: 6px;
  border-radius: 6px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s;
  width: 32px;
  height: 32px;
}

.icon-btn:hover {
  background: var(--bg-hover);
  color: var(--text);
}

.icon-btn.active {
  background: var(--bg-hover);
  color: var(--accent);
}

/* Specific button Tweaks */
#btn-appearance {
  font-family: var(--font-body);
  font-weight: 600;
  letter-spacing: -0.5px;
}

input[type=range].scale-slider {
  flex: 1;
  accent-color: var(--text);
  cursor: pointer;
}

.scale-btn {
  background: var(--bg-hover);
  border: 1px solid var(--border-light);
  color: var(--text);
  width: 24px;
  height: 24px;
  border-radius: 4px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 14px;
}

.scale-btn:hover {
  background: var(--bg-elevated);
}

.scale-value {
  font-size: 12px;
  color: var(--text-muted);
  width: 36px;
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#chat-area {
  /* Apply scaling to the entire chat column (pinned, messages, input) */
  zoom: var(--ui-scale, 1);
}